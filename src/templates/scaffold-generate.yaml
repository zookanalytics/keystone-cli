$schema: https://raw.githubusercontent.com/mhingston/keystone-cli/main/schemas/workflow.json
name: scaffold-generate
description: "Generate file contents from a file plan"

inputs:
  requirements: { type: string }
  blueprint: { type: object }
  files: { type: array }

outputs:
  files: ${{ steps.generate.output }}

steps:
  - id: generate
    type: llm
    agent: software-engineer
    allowClarification: true
    useStandardTools: true
    foreach: ${{ inputs.files }}
    prompt: |
      You are generating the content for a single file based on a system blueprint and a specific file spec.

      <system_blueprint>
        ${{ inputs.blueprint }}
      </system_blueprint>

      Overall user requirements:
      ${{ inputs.requirements }}

      File spec for this file:
      ${{ item }}

      Produce the full file content for the given path. Ensure it aligns with the architectural constraints and dependencies defined in the blueprint.
      Return only JSON with fields: path, content.
    outputSchema:
      type: object
      properties:
        path:
          type: string
        content:
          type: string
      required: [path, content]
