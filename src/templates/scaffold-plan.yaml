$schema: https://raw.githubusercontent.com/mhingston/keystone-cli/main/schemas/workflow.json
name: scaffold-plan
description: "Plan the files for a new workflow and optional agents"

inputs:
  requirements: { type: string }
  blueprint: { type: object }

outputs:
  files: ${{ steps.plan.output.files }}

steps:
  - id: plan
    type: llm
    agent: keystone-architect
    allowClarification: true
    useStandardTools: true
    prompt: |
      You are planning a file structure based on a system blueprint.
      
      <system_blueprint>
        ${{ inputs.blueprint }}
      </system_blueprint>

      User requirements:
      ${{ inputs.requirements }}

      Create a file plan. Follow the architecture and file list provided in the blueprint.
      Use paths under:
      - .keystone/workflows/ for workflows
      - .keystone/workflows/agents/ for agents

      Each file should include:
      - path: relative path
      - purpose: short purpose statement
      - notes: optional implementation guidance

      Return only the structured JSON required by the schema.
    outputSchema:
      type: object
      properties:
        files:
          type: array
          items:
            type: object
            properties:
              path:
                type: string
              purpose:
                type: string
              notes:
                type: string
            required: [path, purpose]
      required: [files]
