$schema: https://raw.githubusercontent.com/mhingston/keystone-cli/main/schemas/workflow.json
name: memory-service
description: "Demonstrate long-term memory capabilities"

steps:
  # Store information in memory
  - id: remember_facts
    type: memory
    op: store
    text: "Keystone CLI was initialized on 2025-01-01 by the engineering team."
    metadata:
      type: "fact"
      confidence: 1.0

  - id: remember_preference
    type: memory
    op: store
    text: "The user prefers TypeScript over JavaScript for all projects."
    metadata:
      type: "preference"
      confidence: 0.9
    needs: [remember_facts]

  # Search for information
  - id: recall_preference
    type: memory
    op: search
    query: "What language does the user like?"
    limit: 1
    needs: [remember_preference]

  # Use recalled information in an LLM step
  - id: confirm_memory
    type: llm
    agent: general
    needs: [recall_preference]
    prompt: |
      Based on this memory:
      ${{ steps.recall_preference.output[0].content }}

      What programming language should I use? Answer in one word.
    outputSchema:
      type: object
      properties:
        language:
          type: string
      required: [language]

  - id: summary
    type: shell
    needs: [confirm_memory]
    run: |
      echo "Memory Service Demo Complete"
      echo "Recalled: ${{ steps.recall_preference.output[0].content }}"
      echo "Decision: ${{ steps.confirm_memory.output.language }}"
