$schema: https://raw.githubusercontent.com/mhingston/keystone-cli/main/schemas/workflow.json
name: artifact-example
description: "Demonstrate artifact upload and download between steps"

steps:
  - id: create_content
    type: shell
    allowInsecure: true
    run: |
      mkdir -p src/templates/features/test-output
      echo "Hello from step 1" > src/templates/features/test-output/file1.txt
      echo "Hello from step 1 (second file)" > src/templates/features/test-output/file2.txt

  - id: upload_files
    type: artifact
    op: upload
    name: build-outputs
    paths: ["test-output/*.txt"]
    needs: [create_content]

  - id: clean_local
    type: shell
    needs: [upload_files]
    run: rm -rf src/templates/features/test-output

  - id: download_files
    type: artifact
    op: download
    name: build-outputs
    path: src/templates/features/downloaded
    needs: [clean_local]

  - id: verify
    type: shell
    needs: [download_files]
    allowInsecure: true
    run: |
      ls -R src/templates/features/downloaded
      cat src/templates/features/downloaded/file1.txt
      rm -rf src/templates/features/downloaded
