$schema: https://raw.githubusercontent.com/mhingston/keystone-cli/main/schemas/workflow.json
name: approval-process
description: "A workflow demonstrating human-in-the-loop and conditional logic"

inputs:
  request_details: { type: string, default: "Access to production database" }

steps:
  - id: request_approval
    type: human
    message: "Do you approve the following request: ${{ inputs.request_details }}?"
    inputType: confirm

  - id: log_approval
    type: shell
    if: ${{ steps.request_approval.output == true }}
    run: echo "Request approved. Proceeding with implementation."
    needs: [request_approval]

  - id: log_rejection
    type: shell
    if: ${{ steps.request_approval.output == false }}
    run: echo "Request rejected. Notifying requester."
    needs: [request_approval]

  - id: get_rejection_reason
    type: human
    if: ${{ steps.request_approval.output == false }}
    message: "Please provide a reason for rejection:"
    inputType: text
    needs: [request_approval]

  - id: finalize_rejection
    type: shell
    if: ${{ steps.request_approval.output == false }}
    run: echo "Rejection reason - ${{ steps.get_rejection_reason.output }}"
    needs: [get_rejection_reason]
